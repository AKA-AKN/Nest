{% load static %}

<head>
  <meta charset="UTF-8" />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
  />
</head>

<script src="{% static 'js/htmx.min.js' %}"></script>

<h3>Find a project</h3>
<input
  autocomplete="off"
  class="form-control"
  id="query"
  name="q"
  placeholder="Type To Search..."
  type="search"
  hx-get="{% url 'search-projects' %}"
  hx-indicator=".htmx-indicator"
  hx-swap="none"
  hx-target="#search-results"
  hx-trigger="load, input changed delay:1000ms, search"
/>
<span class="htmx-indicator"> Searching... </span>

<script>
  document
    .getElementById('query')
    .addEventListener('htmx:afterRequest', function (event) {
      var jsonResponse = event.detail.xhr.response;
      var hits = JSON.parse(jsonResponse);

      const resultsContainer = document.getElementById('search-results');
      resultsContainer.innerHTML = '';

      hits.forEach((hit) => {
        const highlightedName = hit._highlightResult.idx_name.value;
        const topics = hit.idx_topics;
        const createdAt = new Date(hit.idx_created_at * 1000);

        const url = hit.idx_url;

        const resultItem = document.createElement('div');
        resultItem.innerHTML = `
          <h2><a href="${url}" target="_blank">${highlightedName}</a></h2>
          <p>Tags: ${topics}. Created at: ${createdAt}</p>
          <p></p>
        `;

        resultsContainer.appendChild(resultItem);
      });
    });
</script>

<div id="search-results"></div>
